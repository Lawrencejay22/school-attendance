<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href ="" type="image/x-icon">
    <!-- Link to the stylesheet for basic styling. -->
     <link rel="stylesheet" href="style.css">
    <title>Andronico A Maybay Elementary School</title>
    <!-- Tailwind CSS for utility classes -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
    <header>
        <img src="468720408_584890300680052_8912147452898431944_n.jpg" alt="School Logo" class="mx-auto my-4 w-32 h-32 object-cover rounded-full border-4 border-white shadow-lg">
    </header>
<body class="bg-gray-100 text-gray-800 p-4 sm:p-8">
    <div id="message-box" class="message-box"></div>

    <div class="container mx-auto max-w-7xl">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-900 mb-2">Attendance Tracker</h1>
            <p class="text-lg text-gray-600">Easily manage and track student attendance.</p>
            <div id="digital-clock" class="text-3xl font-mono mt-4 text-gray-700"></div>
        </header>

        <!-- Attendance Form and Summary -->
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Attendance Form -->
            <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">Record Attendance</h2>
                <form id="attendance-form" class="space-y-4">
                    <input type="hidden" id="record-id">
                    <div>
                        <label for="student_name" class="block text-sm font-medium text-gray-700">Student Name</label>
                        <input type="text" id="student_name" placeholder="Enter student name" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="subject" class="block text-sm font-medium text-gray-700">Subject</label>
                        <input type="text" id="subject" placeholder="Enter subject" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="section" class="block text-sm font-medium text-gray-700">Section</label>
                        <input type="text" id="section" placeholder="Enter section" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="advisor" class="block text-sm font-medium text-gray-700">Advisor</label>
                        <input type="text" id="advisor" placeholder="Enter advisor name" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="gender" class="block text-sm font-medium text-gray-700">Gender</label>
                            <select id="gender" required
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-blue-500 focus:border-blue-500">
                                <option value="boys">Boy</option>
                                <option value="girls">Girl</option>
                            </select>
                        </div>
                        <div>
                            <label for="status" class="block text-sm font-medium text-gray-700">Status</label>
                            <select id="status" required
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-blue-500 focus:border-blue-500">
                                <option value="present">Present</option>
                                <option value="absent">Absent</option>
                                <option value="late">Late</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="time" class="block text-sm font-medium text-gray-700">Time</label>
                            <input type="time" id="time" required
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="date" class="block text-sm font-medium text-gray-700">Date</label>
                            <input type="date" id="date" required
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                    <div class="flex items-center space-x-2 pt-2">
                        <button type="submit" id="submit-button"
                            class="w-full px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-700 transition-colors">
                            Submit Attendance
                        </button>
                        <button type="button" id="cancel-button"
                            class="w-full px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-700 transition-colors hidden">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>

            <!-- Summary & Buttons -->
            <div class="lg:col-span-2 space-y-8">
                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">Overall Summary</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 text-center">
                        <div class="bg-blue-100 p-4 rounded-lg shadow-sm">
                            <h3 class="font-semibold text-sm text-blue-800">Total Students</h3>
                            <p id="total-students" class="text-xl font-bold mt-1">0</p>
                        </div>
                        <div class="bg-green-100 p-4 rounded-lg shadow-sm">
                            <h3 class="font-semibold text-sm text-green-800">Present</h3>
                            <p id="total-present" class="text-xl font-bold mt-1">0</p>
                        </div>
                        <div class="bg-red-100 p-4 rounded-lg shadow-sm">
                            <h3 class="font-semibold text-sm text-red-800">Absent</h3>
                            <p id="total-absent" class="text-xl font-bold mt-1">0</p>
                        </div>
                        <div class="bg-yellow-100 p-4 rounded-lg shadow-sm">
                            <h3 class="font-semibold text-sm text-yellow-800">Late</h3>
                            <p id="total-late" class="text-xl font-bold mt-1">0</p>
                        </div>
                    </div>
                    <div class="mt-4 text-center">
                        <span id="present-percentage" class="text-green-600 font-medium"></span> |
                        <span id="absent-percentage" class="text-red-600 font-medium"></span> |
                        <span id="late-percentage" class="text-yellow-600 font-medium"></span>
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <button id="export-button"
                        class="flex items-center justify-center space-x-2 px-4 py-2 bg-gray-700 text-white rounded-md hover:bg-gray-900 transition-colors">
                        <i class="fas fa-file-excel"></i>
                        <span>Export to CSV</span>
                    </button>
                    <button id="clear-button"
                        class="flex items-center justify-center space-x-2 px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-700 transition-colors">
                        <i class="fas fa-trash-alt"></i>
                        <span>Clear All Data</span>
                    </button>
                </div>

                <!-- Tables -->
                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">Boys' Records</h2>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Student
                                </th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Subject
                                </th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Section
                                </th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Advisor
                                </th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Status
                                </th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Actions
                                </th>
                            </tr>
                        </thead>
                        <tbody id="boys-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">Girls' Records</h2>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Student
                                </th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Subject
                                </th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Section
                                </th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Advisor
                                </th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Status
                                </th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Actions
                                </th>
                            </tr>
                        </thead>
                        <tbody id="girls-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Confirmation Modal for Clear All -->
    <div id="confirmation-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 class="text-xl font-bold mb-4 text-gray-800">Confirm Deletion</h3>
            <p class="text-gray-600 mb-6">Are you sure you want to clear all attendance records? This action cannot be
                undone.</p>
            <div class="flex justify-end space-x-4">
                <button id="confirm-no"
                    class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors">
                    Cancel
                </button>
                <button id="confirm-yes"
                    class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-700 transition-colors">
                    Clear
                </button>
            </div>
        </div>
    </div>
    
    <!-- Right-click context menu -->
    <button id="copy-link-button" class="copy-link-button bg-gray-800 text-white text-sm p-2 rounded-md shadow-lg hover:bg-gray-700">
        Copy Link
    </button>

    <script>
        /* ==========================================================================
            1. DOM Elements
        ========================================================================== */
        const messageBox = document.getElementById('message-box');
        const attendanceForm = document.getElementById('attendance-form');
        const exportButton = document.getElementById('export-button');
        const clearButton = document.getElementById('clear-button');
        const digitalClockEl = document.getElementById('digital-clock');
        const studentNameInput = document.getElementById('student_name');
        const subjectInput = document.getElementById('subject');
        const genderInput = document.getElementById('gender');
        const timeInput = document.getElementById('time');
        const dateInput = document.getElementById('date');
        const statusInput = document.getElementById('status');
        const recordIdInput = document.getElementById('record-id');
        const submitButton = document.getElementById('submit-button');
        const cancelButton = document.getElementById('cancel-button');
        const copyLinkButton = document.getElementById('copy-link-button');
        const sectionInput = document.getElementById('section');
        const advisorInput = document.getElementById('advisor');

        const totalStudentsEl = document.getElementById('total-students');
        const totalPresentEl = document.getElementById('total-present');
        const totalAbsentEl = document.getElementById('total-absent');
        const totalLateEl = document.getElementById('total-late');
        const presentPercentageEl = document.getElementById('present-percentage');
        const absentPercentageEl = document.getElementById('absent-percentage');
        const latePercentageEl = document.getElementById('late-percentage');

        const boysTableBody = document.getElementById('boys-table-body');
        const girlsTableBody = document.getElementById('girls-table-body');

        // Modal elements
        const confirmationModal = document.getElementById('confirmation-modal');
        const confirmYes = document.getElementById('confirm-yes');
        const confirmNo = document.getElementById('confirm-no');


        /* ==========================================================================
            2. Data Storage & Variables
        ========================================================================== */
        const LOCAL_STORAGE_KEY = 'attendanceRecords';
        let attendanceRecords = [];
        let editingRecordId = null;


        /* ==========================================================================
            3. Helper Functions
        ========================================================================== */

        /**
         * Displays a temporary message box for user feedback.
         * @param {string} text - The message to display.
         * @param {boolean} isError - True if the message is an error.
         */
        function showMessage(text, isError = false) {
            messageBox.textContent = text;
            messageBox.className = `message-box ${isError ? 'error' : 'success'} show`;

            setTimeout(() => {
                messageBox.classList.remove('show');
            }, 3000);
        }

        /**
         * Updates the digital clock display to a 12-hour format with AM/PM.
         */
        function updateClock() {
            const now = new Date();
            let hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            const am_pm = hours >= 12 ? 'PM' : 'AM';

            hours = hours % 12;
            hours = hours ? hours : 12; // The hour '0' should be '12'

            digitalClockEl.textContent = `${hours}:${minutes}:${seconds} ${am_pm}`;
        }

        /**
         * Updates the summary tables and counts based on attendance data.
         * @param {Array<Object>} attendanceData - An array of attendance records.
         */
        function updateSummary(attendanceData) {
            let totalPresent = 0;
            let totalAbsent = 0;
            let totalLate = 0;
            let totalStudents = attendanceData.length;

            let boysPresent = 0;
            let boysAbsent = 0;
            let boysLate = 0;
            let girlsPresent = 0;
            let girlsAbsent = 0;
            let girlsLate = 0;

            boysTableBody.innerHTML = '';
            girlsTableBody.innerHTML = '';

            attendanceData.forEach(entry => {
                const newRow = document.createElement('tr');
                newRow.dataset.id = entry.id;
                const statusClass = `status-${entry.status}`;
                newRow.innerHTML = `
                    <td class="px-4 py-2 whitespace-nowrap">${entry.student_name}</td>
                    <td class="px-4 py-2 whitespace-nowrap">${entry.subject}</td>
                    <td class="px-4 py-2 whitespace-nowrap">${entry.section}</td>
                    <td class="px-4 py-2 whitespace-nowrap">${entry.advisor}</td>
                    <td class="px-4 py-2 whitespace-nowrap font-medium ${statusClass}">${entry.status.charAt(0).toUpperCase() + entry.status.slice(1)}</td>
                    <td class="px-4 py-2 whitespace-nowrap">
                        <div class="flex items-center space-x-2">
                            <button type="button" class="edit-btn text-blue-500 hover:text-blue-700 transition-colors" data-id="${entry.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button type="button" class="delete-btn text-red-500 hover:text-red-700 transition-colors" data-id="${entry.id}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </td>
                `;

                if (entry.gender === 'boys') {
                    boysTableBody.appendChild(newRow);
                    if (entry.status === 'present') boysPresent++;
                    else if (entry.status === 'absent') boysAbsent++;
                    else if (entry.status === 'late') boysLate++;
                } else if (entry.gender === 'girls') {
                    girlsTableBody.appendChild(newRow);
                    if (entry.status === 'present') girlsPresent++;
                    else if (entry.status === 'absent') girlsAbsent++;
                    else if (entry.status === 'late') girlsLate++;
                }

                if (entry.status === 'present') totalPresent++;
                else if (entry.status === 'absent') totalAbsent++;
                else if (entry.status === 'late') totalLate++;
            });

            totalStudentsEl.textContent = totalStudents;
            totalPresentEl.textContent = totalPresent;
            totalAbsentEl.textContent = totalAbsent;
            totalLateEl.textContent = totalLate;

            const presentPercentage = totalStudents > 0 ? ((totalPresent / totalStudents) * 100).toFixed(2) : 0;
            presentPercentageEl.textContent = `Present: ${presentPercentage}%`;

            const absentPercentage = totalStudents > 0 ? ((totalAbsent / totalStudents) * 100).toFixed(2) : 0;
            absentPercentageEl.textContent = `Absent: ${absentPercentage}%`;

            const latePercentage = totalStudents > 0 ? ((totalLate / totalStudents) * 100).toFixed(2) : 0;
            latePercentageEl.textContent = `Late: ${latePercentage}%`;

            // Attach event listeners for the new buttons
            document.querySelectorAll('.edit-btn').forEach(button => {
                button.addEventListener('click', handleEdit);
            });
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', handleDelete);
            });
        }

        /**
         * Loads attendance data from local storage.
         */
        function loadDataFromLocalStorage() {
            const storedData = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (storedData) {
                try {
                    attendanceRecords = JSON.parse(storedData);
                    updateSummary(attendanceRecords);
                } catch (e) {
                    console.error("Error parsing local storage data:", e);
                    attendanceRecords = [];
                }
            }
        }

        /**
         * Saves attendance data to local storage.
         */
        function saveDataToLocalStorage() {
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(attendanceRecords));
        }

        /**
         * Clears all attendance data from local storage and the UI.
         */
        function clearData() {
            localStorage.removeItem(LOCAL_STORAGE_KEY);
            attendanceRecords = [];
            updateSummary(attendanceRecords);
            showMessage('All attendance data has been cleared.');
        }

        /**
         * Handles the click event for the edit button.
         * @param {Event} event - The click event.
         */
        function handleEdit(event) {
            const recordId = event.currentTarget.dataset.id;
            const recordToEdit = attendanceRecords.find(record => record.id === recordId);

            if (recordToEdit) {
                // Populate the form with the data
                studentNameInput.value = recordToEdit.student_name;
                subjectInput.value = recordToEdit.subject;
                genderInput.value = recordToEdit.gender;
                sectionInput.value = recordToEdit.section; // Added
                advisorInput.value = recordToEdit.advisor; // Added

                // Convert the formatted time back to a time input friendly format
                const [timePart, ampm] = recordToEdit.time_value.split(' ');
                let [hours, minutes] = timePart.split(':');
                hours = parseInt(hours);
                if (ampm === 'PM' && hours !== 12) {
                    hours += 12;
                } else if (ampm === 'AM' && hours === 12) {
                    hours = 0;
                }
                timeInput.value = `${String(hours).padStart(2, '0')}:${minutes}`;

                dateInput.value = recordToEdit.date;
                statusInput.value = recordToEdit.status;
                recordIdInput.value = recordId;

                // Set a global flag for edit mode
                editingRecordId = recordId;

                // Change the submit button text and show cancel button
                submitButton.textContent = 'Update Attendance';
                submitButton.classList.remove('bg-blue-500', 'hover:bg-blue-700');
                submitButton.classList.add('bg-green-500', 'hover:bg-green-700');
                cancelButton.classList.remove('hidden');

                // Scroll to the form
                attendanceForm.scrollIntoView({
                    behavior: 'smooth'
                });
            }
        }

        /**
         * Handles the click event for the delete button.
         * @param {Event} event - The click event.
         */
        function handleDelete(event) {
            const recordId = event.currentTarget.dataset.id;
            if (recordId) {
                attendanceRecords = attendanceRecords.filter(record => record.id !== recordId);
                saveDataToLocalStorage();
                updateSummary(attendanceRecords);
                showMessage('Attendance record deleted successfully!');
            }
        }

        /**
         * Resets the form and returns to 'add' mode.
         */
        function resetForm() {
            attendanceForm.reset();
            editingRecordId = null;
            recordIdInput.value = '';
            submitButton.textContent = 'Submit Attendance';
            submitButton.classList.remove('bg-green-500', 'hover:bg-green-700');
            submitButton.classList.add('bg-blue-500', 'hover:bg-blue-700');
            cancelButton.classList.add('hidden');
        }


        /* ==========================================================================
            4. Event Listeners
        ========================================================================== */

        // Listen for form submissions to add or update an attendance record
        attendanceForm.addEventListener('submit', function (event) {
            event.preventDefault();

            const studentName = studentNameInput.value.trim();
            const subject = subjectInput.value.trim();
            const gender = genderInput.value;
            const timeValue = timeInput.value;
            const date = dateInput.value;
            const status = statusInput.value;
            const section = sectionInput.value.trim();
            const advisor = advisorInput.value.trim();

            if (studentName && subject && gender && timeValue && date && status && section && advisor) {
                const [hours, minutes] = timeValue.split(':');
                let h = parseInt(hours, 10);
                const ampm = h >= 12 ? 'PM' : 'AM';
                h = h % 12;
                h = h ? h : 12;
                const formattedTime = `${h}:${minutes.padStart(2, '0')} ${ampm}`;

                const newEntry = {
                    id: editingRecordId || crypto.randomUUID(),
                    student_name: studentName,
                    subject: subject,
                    gender: gender,
                    time_value: formattedTime,
                    date: date,
                    status: status,
                    section: section,
                    advisor: advisor
                };

                if (editingRecordId) {
                    const index = attendanceRecords.findIndex(record => record.id === editingRecordId);
                    if (index !== -1) {
                        attendanceRecords[index] = newEntry;
                    }
                    showMessage('Attendance record updated successfully!');
                } else {
                    attendanceRecords.push(newEntry);
                    showMessage('Attendance submitted successfully!');
                }

                saveDataToLocalStorage();
                updateSummary(attendanceRecords);
                resetForm();

            } else {
                showMessage('Please fill out all fields.', true);
            }
        });

        // Cancel edit button listener
        cancelButton.addEventListener('click', resetForm);

        // Listen for clicks on the export button to download data as a CSV
        exportButton.addEventListener('click', function () {
            showMessage('Exporting data to Excel...');

            const totalStudents = attendanceRecords.length;
            const totalPresent = attendanceRecords.filter(r => r.status === 'present').length;
            const totalAbsent = attendanceRecords.filter(r => r.status === 'absent').length;
            const totalLate = attendanceRecords.filter(r => r.status === 'late').length;
            const boysPresent = attendanceRecords.filter(r => r.gender === 'boys' && r.status === 'present').length;
            const boysAbsent = attendanceRecords.filter(r => r.gender === 'boys' && r.status === 'absent').length;
            const boysLate = attendanceRecords.filter(r => r.gender === 'boys' && r.status === 'late').length;
            const girlsPresent = attendanceRecords.filter(r => r.gender === 'girls' && r.status === 'present').length;
            const girlsAbsent = attendanceRecords.filter(r => r.gender === 'girls' && r.status === 'absent').length;
            const girlsLate = attendanceRecords.filter(r => r.gender === 'girls' && r.status === 'late').length;
            const presentPercentage = totalStudents > 0 ? ((totalPresent / totalStudents) * 100).toFixed(2) : 0;
            const absentPercentage = totalStudents > 0 ? ((totalAbsent / totalStudents) * 100).toFixed(2) : 0;
            const latePercentage = totalStudents > 0 ? ((totalLate / totalStudents) * 100).toFixed(2) : 0;

            let csv = [];

            // Add overall summary section
            csv.push('Attendance Summary');
            csv.push(`Total Students,${totalStudents}`);
            csv.push(`Total Present,${totalPresent}`);
            csv.push(`Total Absent,${totalAbsent}`);
            csv.push(`Total Late,${totalLate}`);
            csv.push(`Present Percentage,${presentPercentage}%`);
            csv.push(`Absent Percentage,${absentPercentage}%`);
            csv.push(`Late Percentage,${latePercentage}%`);
            csv.push(''); // Empty line for separation
            csv.push('Boys Summary');
            csv.push(`Boys Present,${boysPresent}`);
            csv.push(`Boys Absent,${boysAbsent}`);
            csv.push(`Boys Late,${boysLate}`);
            csv.push(''); // Empty line for separation
            csv.push('Girls Summary');
            csv.push(`Girls Present,${girlsPresent}`);
            csv.push(`Girls Absent,${girlsAbsent}`);
            csv.push(`Girls Late,${girlsLate}`);
            csv.push(''); // Empty line for separation

            // Add detailed attendance records header
            csv.push("Category,Student Name,Subject,Section,Advisor,Time,Date,Status");

            // Add detailed records
            attendanceRecords.forEach(entry => {
                const row = [
                    entry.gender === 'boys' ? 'Boy' : 'Girl',
                    `"${entry.student_name}"`,
                    `"${entry.subject}"`,
                    `"${entry.section}"`,
                    `"${entry.advisor}"`,
                    `"${entry.time_value}"`,
                    entry.date,
                    entry.status.charAt(0).toUpperCase() + entry.status.slice(1)
                ];
                csv.push(row.join(','));
            });

            const csvString = csv.join('\n');

            const blob = new Blob([csvString], {
                type: 'text/csv;charset=utf-8;'
            });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', 'attendance.csv');
            document.body.appendChild(link);
            link.click();

            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            setTimeout(() => {
                showMessage('Data exported successfully!');
            }, 1000);
        });

        // Listen for clicks on the clear button to show the modal
        clearButton.addEventListener('click', function () {
            confirmationModal.style.display = 'flex';
        });

        // Listen for clicks on the modal's confirmation buttons
        confirmYes.addEventListener('click', function () {
            clearData();
            confirmationModal.style.display = 'none';
        });

        confirmNo.addEventListener('click', function () {
            confirmationModal.style.display = 'none';
        });

        // Add event listener to hide the copy link button on any click
        document.body.addEventListener('click', (e) => {
            if (copyLinkButton.style.display === 'block') {
                copyLinkButton.style.display = 'none';
            }
        });

        // Listen for the contextmenu (right-click) event to show the copy link button
        document.body.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            copyLinkButton.style.display = 'block';
            copyLinkButton.style.top = `${e.clientY}px`;
            copyLinkButton.style.left = `${e.clientX}px`;
        });

        // Listen for clicks on the copy link button
        copyLinkButton.addEventListener('click', () => {
            const urlToCopy = window.location.href;
            const tempInput = document.createElement('input');
            tempInput.value = urlToCopy;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            showMessage('Link copied to clipboard!');
            copyLinkButton.style.display = 'none';
        });


        /* ==========================================================================
            5. Initialization
        ========================================================================== */
        // Update the clock every second
        setInterval(updateClock, 1000);
        updateClock();

        // Main function to run on window load
        window.onload = function () {
            loadDataFromLocalStorage();
        }
    </script>
</body>

</html>
